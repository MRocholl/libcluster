language: cpp
sudo: required

addons:
    apt:
        packages:
            - cmake
            - libeigen3-dev
            - libboost-all-dev
            - libboost-python-dev
            - python-numpy

# use sed to replace the SSH URL with the public URL, then init and update
# submodules, thanks https://gist.github.com/petrbel/c3bf7e0f59c22a52f534
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive

install:
    - cd $TRAVIS_BUILD_DIR
    - mkdir build
    - cd build
    - cmake -DBUILD_PYTHON_INTERFACE=ON -DBUILD_USE_PYTHON3=OFF ..
    - make
    - sudo make install

script:
    - cd $TRAVIS_BUILD_DIR/build
    - ./cluster_test
    - ./scluster_test
    - ./mcluster_test
    - sudo ldconfig
    - cd ../python
    - ./testapi.py
